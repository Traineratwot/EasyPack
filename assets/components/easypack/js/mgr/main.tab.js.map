{"version":3,"names":[],"mappings":"","sources":["assets/components/easypack/js/mgr/main.tab.js"],"sourcesContent":["Ext.onReady(function() {\r\n\tMODx.add({\r\n\t\txtype: 'EasyPack-panel-home'\r\n\t})\r\n\tsetTimeout(function(){\r\n\t\tdocument.querySelectorAll('pre code').forEach((block) => {\r\n\t\t\tif(typeof hljs != 'undefined') {\r\n\t\t\t\thljs.highlightBlock(block)\r\n\t\t\t}\r\n\t\t})\r\n\t},1000)\r\n})\r\nvar EasyPack = function(config) {\r\n\tconfig = config || {}\r\n\tEasyPack.superclass.constructor.call(this, config)\r\n}\r\nExt.extend(EasyPack, MODx.Component, { // Перечисляем группы, внутрь которых будем \"складывать\" объекты\r\n\tpanel: {},\r\n\tpage: {},\r\n\twindow: {},\r\n\tgrid: {},\r\n\ttree: {},\r\n\tcombo: {},\r\n\tconfig: {},\r\n\tview: {},\r\n\tutils: {}\r\n})\r\nExt.reg('EasyPack', EasyPack)\r\nEasyPack = new EasyPack()\r\n\r\nvar entityMap = {\r\n\t'&': '&amp;',\r\n\t'<': '&lt;',\r\n\t'>': '&gt;',\r\n\t'\"': '&quot;',\r\n\t'\\'': '&#39;',\r\n\t'/': '&#x2F;',\r\n\t'`': '&#x60;',\r\n\t'=': '&#x3D;'\r\n}\r\nvar ToolTip = {\r\n\trender: function(e) {\r\n\t\tif(e.toolTip && e.getEl()) {\r\n\t\t\tExt.QuickTips.register({\r\n\t\t\t\ttarget: e.getEl(),\r\n\t\t\t\ttext: e.toolTip\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction escapeHtml(string) {\r\n\treturn String(string).replace(/[&<>\"'`=\\/]/g, function(s) {\r\n\t\treturn entityMap[s]\r\n\t})\r\n}\r\n\r\nvar defaultRenderer = function(val) {\r\n\treturn val || '<span class=\"false\">' + _('ext_emptygroup') + '<span>'\r\n}\r\nvar elemTemplate = new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t<strong>{name}</strong><small>({category_name})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>', {compiled: true})\r\nvar elemTemplate2 = new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<tpl if=\"id\">({id})</tpl>\\\r\n\t\t\t\t\t\t\t<strong>{templatename}</strong><small>({category_name})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>', {compiled: true})\r\nvar elemTemplate3 = new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<strong>{text_lex}</strong><small>({parent}),({namespace})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>', {compiled: true})\r\nvar elemTemplate4 = new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<strong>{name_trans}</strong><small>({namespace})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>', {compiled: true})\r\nvar elemTemplate5 = new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<strong>{url}</strong><small>({snippet})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>', {compiled: true})\r\nvar elemTemplate6 = new Ext.XTemplate('<tpl for=\".\">\\\r\n\t\t\t\t\t\t<div class=\"x-combo-list-item\">\\\r\n\t\t\t\t\t\t\t<strong>({id}) {pagetitle}</strong><small>({uri})</small>\\\r\n\t\t\t\t\t\t</div>\\\r\n\t\t\t\t\t</tpl>', {compiled: true})\r\nvar htmlRenderer = function(val) {\r\n\treturn '<code> ' + escapeHtml(defaultRenderer(val)) + ' </code>'\r\n}\r\nvar JSONRenderer = function(val) {\r\n\tif(val) {\r\n\t\ttry {\r\n\t\t\treturn hljs.highlight('json', val)\r\n\t\t} finally {\r\n\t\t\treturn `<pre><code class=\"language-json\">${val}</code></pre>`\r\n\t\t}\r\n\t}\r\n\treturn defaultRenderer(val)\r\n}\r\nvar todata = function(str, key = 'name') {\r\n\tif(str) {\r\n\t\tvar arr = JSON.parse(str)\r\n\t\tif(arr.constructor.name == 'Array' || arr.constructor.name == 'Object') {\r\n\t\t\tvar res = []\r\n\t\t\tfor(var i of arr) {\r\n\t\t\t\tvar t = {}\r\n\t\t\t\tt[key] = i\r\n\t\t\t\tres.push(t)\r\n\t\t\t}\r\n\t\t\treturn res\r\n\t\t}\r\n\t}\r\n\treturn null\r\n}\r\n\r\n//основной блок\r\nEasyPack.panel.Home = function(config) {\r\n\tconfig = config || {}\r\n\tvar columns = [ // Добавляем ширину и заголовок столбца\r\n\t\t{\r\n\t\t\tdataIndex: 'id',\r\n\t\t\twidth: 200,\r\n\t\t\theader: _('id'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: defaultRenderer\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'name',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('name'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: function(val, e, b) {\r\n\t\t\t\tif(b.data.path_to_last_transport) {\r\n\t\t\t\t\treturn `<a href=\"${b.data.path_to_last_transport}\" title=\"${_('EasyPack.path_to_last_transport')}\">${val}</a>`\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn `${val}`\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'version',\r\n\t\t\twidth: 200,\r\n\t\t\theader: _('version'),\r\n\t\t\temptyText: '0.0.1-pl',\r\n\t\t\tsortable: true,\r\n\t\t\ttooltip: _('EasyPack.description.version'),\r\n\t\t\trenderer: defaultRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\tdataIndex: 'date',\r\n\t\t\twidth: 330,\r\n\t\t\ttooltip: _('EasyPack.description.date'),\r\n\t\t\theader: _('date'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: defaultRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\tdataIndex: 'chunks',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('chunks'),\r\n\t\t\ttooltip: _('EasyPack.description.chunks'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: JSONRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'snippets',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('snippets'),\r\n\t\t\ttooltip: _('EasyPack.description.snippets'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: JSONRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'plugins',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('plugins'),\r\n\t\t\ttooltip: _('EasyPack.description.plugins'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: JSONRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'templates',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('templates'),\r\n\t\t\ttooltip: _('EasyPack.description.templates'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: JSONRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'resources',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('resources'),\r\n\t\t\ttooltip: _('EasyPack.description.resources'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: JSONRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'menus',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('edit_menu'),\r\n\t\t\ttooltip: _('EasyPack.description.menus'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: JSONRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'settings',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('settings'),\r\n\t\t\ttooltip: _('EasyPack.description.settings'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: JSONRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\tdataIndex: 'core',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('EasyPack.core'),\r\n\t\t\ttooltip: _('EasyPack.description.core'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: defaultRenderer,\r\n\t\t\thidden: true,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'assets',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('EasyPack.assets'),\r\n\t\t\ttooltip: _('EasyPack.description.assets'),\r\n\t\t\tsortable: true,\r\n\t\t\thidden: true,\r\n\t\t\trenderer: defaultRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\tdataIndex: 'requires',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('EasyPack.requires'),\r\n\t\t\ttooltip: _('EasyPack.description.requires'),\r\n\t\t\tsortable: true,\r\n\t\t\thidden: false,\r\n\t\t\trenderer: JSONRenderer,\r\n\t\t\teditor: {xtype: 'textarea'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'readme',\r\n\t\t\twidth: 330,\r\n\t\t\ttooltip: _('EasyPack.description.readme'),\r\n\t\t\theader: _('EasyPack.readme'),\r\n\t\t\tsortable: true,\r\n\t\t\thidden: true,\r\n\t\t\trenderer: defaultRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'changelog',\r\n\t\t\twidth: 330,\r\n\t\t\ttooltip: _('EasyPack.description.changelog'),\r\n\t\t\theader: _('EasyPack.changelog'),\r\n\t\t\tsortable: true,\r\n\t\t\thidden: true,\r\n\t\t\trenderer: defaultRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\tdataIndex: 'tables',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('EasyPack.tables'),\r\n\t\t\ttooltip: _('EasyPack.description.tables'),\r\n\t\t\tsortable: true,\r\n\t\t\thidden: true,\r\n\t\t\trenderer: JSONRenderer,\r\n\t\t\teditor: {xtype: 'textarea'}\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\tdataIndex: 'setup_option',\r\n\t\t\twidth: 330,\r\n\t\t\theader: _('EasyPack.setup_option'),\r\n\t\t\ttooltip: _('EasyPack.description.setup_option'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: defaultRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'php_resolver',\r\n\t\t\twidth: 330,\r\n\t\t\ttooltip: _('EasyPack.description.php_resolver'),\r\n\t\t\theader: _('EasyPack.php_resolver'),\r\n\t\t\tsortable: true,\r\n\t\t\trenderer: defaultRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t\t{\r\n\t\t\tdataIndex: 'license',\r\n\t\t\twidth: 330,\r\n\t\t\ttooltip: _('EasyPack.description.license'),\r\n\t\t\theader: _('EasyPack.license'),\r\n\t\t\tsortable: true,\r\n\t\t\thidden: true,\r\n\t\t\trenderer: defaultRenderer,\r\n\t\t\teditor: {xtype: 'textfield'}\r\n\t\t},\r\n\t]\r\n\tif(modUtil) {\r\n\t\tcolumns.push(\r\n\t\t\t{\r\n\t\t\t\tdataIndex: 'modUtilitiesRest',\r\n\t\t\t\twidth: 330,\r\n\t\t\t\ttooltip: _('EasyPack.description.modUtilitiesRest'),\r\n\t\t\t\theader: _('EasyPack.modUtilitiesRest'),\r\n\t\t\t\tsortable: true,\r\n\t\t\t\thidden: true,\r\n\t\t\t\trenderer: JSONRenderer,\r\n\t\t\t\teditor: {xtype: 'textfield'}\r\n\t\t\t}\r\n\t\t)\r\n\t}\r\n\tvar app = {\r\n\t\tcls: 'container', // Добавляем отступы\r\n\t\titems: [{\r\n\t\t\thtml: ' <h2>' + _('EasyPack') + ' <small style=\"font-size: 10px\"><a href=\"https://forms.gle/E9hZht9RthdcX6Ur7\" target=\"_blank\">Bug report</a></small></h2>',\r\n\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'modx-tabs',\r\n\t\t\t\tdeferredRender: false,\r\n\t\t\t\tborder: true,\r\n\t\t\t\titems: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttitle: _('EasyPack.Packages'),\r\n\t\t\t\t\t\titems: [{\r\n\t\t\t\t\t\t\tid: 'EasyPack-main-table',\r\n\t\t\t\t\t\t\txtype: 'EasyPack-grid',\r\n\t\t\t\t\t\t\tcolumns: columns,\r\n\t\t\t\t\t\t\tfields: [\r\n\t\t\t\t\t\t\t\t'id',\r\n\t\t\t\t\t\t\t\t'name',\r\n\t\t\t\t\t\t\t\t'version',\r\n\t\t\t\t\t\t\t\t'date',\r\n\t\t\t\t\t\t\t\t'chunks',\r\n\t\t\t\t\t\t\t\t'snippets',\r\n\t\t\t\t\t\t\t\t'plugins',\r\n\t\t\t\t\t\t\t\t'templates',\r\n\t\t\t\t\t\t\t\t'resources',\r\n\t\t\t\t\t\t\t\t'menus',\r\n\t\t\t\t\t\t\t\t'settings',\r\n\t\t\t\t\t\t\t\t'core',\r\n\t\t\t\t\t\t\t\t'assets',\r\n\t\t\t\t\t\t\t\t'requires',\r\n\t\t\t\t\t\t\t\t'readme',\r\n\t\t\t\t\t\t\t\t'changelog',\r\n\t\t\t\t\t\t\t\t'setup_option',\r\n\t\t\t\t\t\t\t\t'php_resolver',\r\n\t\t\t\t\t\t\t\t'license',\r\n\t\t\t\t\t\t\t\t'tables',\r\n\t\t\t\t\t\t\t\t'path_to_last_transport',\r\n\t\t\t\t\t\t\t\t'modUtilitiesRest',\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\ttbar: [{\r\n\t\t\t\t\t\t\t\txtype: 'button', // Перемещаем сюда нашу кнопку\r\n\t\t\t\t\t\t\t\ttext: _('EasyPack.create_new_package'),\r\n\t\t\t\t\t\t\t\tcls: 'primary-button',\r\n\t\t\t\t\t\t\t\thandler: function() {\r\n\t\t\t\t\t\t\t\t\tMODx.load({\r\n\t\t\t\t\t\t\t\t\t\txtype: 'EasyPack-window-add',\r\n\t\t\t\t\t\t\t\t\t}).show()\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t}],\r\n\t\t\t\t\t\t\taction: 'mgr/get',\r\n\t\t\t\t\t\t\tsave_action: 'mgr/update',\r\n\t\t\t\t\t\t\tautosave: true,\r\n\t\t\t\t\t\t\tgetMenu: function(grid, rowIndex) {\r\n\t\t\t\t\t\t\t\tvar m = []\r\n\t\t\t\t\t\t\t\tm.push({\r\n\t\t\t\t\t\t\t\t\ttext: _('delete'),\r\n\t\t\t\t\t\t\t\t\tgrid: grid,\r\n\t\t\t\t\t\t\t\t\trowIndex: rowIndex,\r\n\t\t\t\t\t\t\t\t\thandler: this.del\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tm.push({\r\n\t\t\t\t\t\t\t\t\ttext: _('update'),\r\n\t\t\t\t\t\t\t\t\tgrid: grid,\r\n\t\t\t\t\t\t\t\t\trowIndex: rowIndex,\r\n\t\t\t\t\t\t\t\t\thandler: this.update\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tm.push({\r\n\t\t\t\t\t\t\t\t\ttext: _('EasyPack.create_structure'),\r\n\t\t\t\t\t\t\t\t\tgrid: grid,\r\n\t\t\t\t\t\t\t\t\trowIndex: rowIndex,\r\n\t\t\t\t\t\t\t\t\thandler: this.create\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tm.push({\r\n\t\t\t\t\t\t\t\t\ttext: _('EasyPack.build'),\r\n\t\t\t\t\t\t\t\t\tgrid: grid,\r\n\t\t\t\t\t\t\t\t\trowIndex: rowIndex,\r\n\t\t\t\t\t\t\t\t\thandler: this.build\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tm.push({\r\n\t\t\t\t\t\t\t\t\ttext: _('EasyPack.getResolver'),\r\n\t\t\t\t\t\t\t\t\tgrid: grid,\r\n\t\t\t\t\t\t\t\t\trowIndex: rowIndex,\r\n\t\t\t\t\t\t\t\t\thandler: this.getResolver\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t// m.push({\r\n\t\t\t\t\t\t\t\t// \ttext: _('EasyPack.test'),\r\n\t\t\t\t\t\t\t\t// \tgrid: grid,\r\n\t\t\t\t\t\t\t\t// \trowIndex: rowIndex,\r\n\t\t\t\t\t\t\t\t// \thandler: this.test\r\n\t\t\t\t\t\t\t\t// })\r\n\t\t\t\t\t\t\t\treturn m\r\n\t\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\t\tdel: function() {\r\n\t\t\t\t\t\t\t\tvar cs = this.getSelectedAsList()\r\n\t\t\t\t\t\t\t\tvar self = this\r\n\t\t\t\t\t\t\t\tMODx.msg.confirm({\r\n\t\t\t\t\t\t\t\t\ttitle: _('delete'),\r\n\t\t\t\t\t\t\t\t\ttext: _('confirm_remove'),\r\n\t\t\t\t\t\t\t\t\turl: EasyPackConnector_url,\r\n\t\t\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\t\t\taction: 'mgr/del',\r\n\t\t\t\t\t\t\t\t\t\tid: cs,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tlisteners: {\r\n\t\t\t\t\t\t\t\t\t\t'success': {\r\n\t\t\t\t\t\t\t\t\t\t\tfn: function(r) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(!r.success) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: _('undeleted'),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Ошибка',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelay: 3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: _('delete'),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Готово',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelay: 3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tself.refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t}, scope: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tbuild: function() {\r\n\t\t\t\t\t\t\t\tvar cs = this.getSelectedAsList()\r\n\t\t\t\t\t\t\t\tvar self = this\r\n\t\t\t\t\t\t\t\tMODx.msg.confirm({\r\n\t\t\t\t\t\t\t\t\ttitle: _('create'),\r\n\t\t\t\t\t\t\t\t\ttext: _('confirm'),\r\n\t\t\t\t\t\t\t\t\turl: EasyPackConnector_url,\r\n\t\t\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\t\t\taction: 'mgr/build/build',\r\n\t\t\t\t\t\t\t\t\t\tid: cs,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tlisteners: {\r\n\t\t\t\t\t\t\t\t\t\t'success': {\r\n\t\t\t\t\t\t\t\t\t\t\tfn: function(r) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif(!r.success) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'building',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: 'Ошибка',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelay: 3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(r)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: 'building',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: `Готово ${r.object.time}<br>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"${r.object.path}\" target=\"_blank\" >Скачать</a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelay: 10\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tself.refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t}, scope: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tupdate: function() {\r\n\t\t\t\t\t\t\t\tvar cs = this.getSelectedAsList()\r\n\t\t\t\t\t\t\t\tvar self = this\r\n\t\t\t\t\t\t\t\tvar data = this.getSelectionModel().getSelections()[0].data\r\n\t\t\t\t\t\t\t\tMODx.load({\r\n\t\t\t\t\t\t\t\t\txtype: 'EasyPack-window-add',\r\n\t\t\t\t\t\t\t\t\ttitle: `обновить ${data.name}`,\r\n\t\t\t\t\t\t\t\t\tupdateId: cs,\r\n\t\t\t\t\t\t\t\t\tupdateData: data,\r\n\t\t\t\t\t\t\t\t\taction: self.save_action,\r\n\t\t\t\t\t\t\t\t}).show()\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcreate: function() {\r\n\t\t\t\t\t\t\t\tvar cs = this.getSelectedAsList()\r\n\t\t\t\t\t\t\t\tvar self = this\r\n\t\t\t\t\t\t\t\tvar data = this.getSelectionModel().getSelections()[0].data\r\n\t\t\t\t\t\t\t\tMODx.load({\r\n\t\t\t\t\t\t\t\t\txtype: 'EasyPack-window-create',\r\n\t\t\t\t\t\t\t\t\ttitle: _('EasyPack.create') + ` ${data.name}`,\r\n\t\t\t\t\t\t\t\t\tupdateId: cs,\r\n\t\t\t\t\t\t\t\t\tupdateData: data,\r\n\t\t\t\t\t\t\t\t}).show()\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\ttest: function() {\r\n\t\t\t\t\t\t\t\tvar cs = this.getSelectedAsList()\r\n\t\t\t\t\t\t\t\tvar self = this\r\n\t\t\t\t\t\t\t\tvar data = this.getSelectionModel().getSelections()[0].data\r\n\t\t\t\t\t\t\t\tMODx.msg.confirm({\r\n\t\t\t\t\t\t\t\t\ttitle: _('create'),\r\n\t\t\t\t\t\t\t\t\ttext: _('confirm'),\r\n\t\t\t\t\t\t\t\t\turl: EasyPackConnector_url,\r\n\t\t\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\t\t\taction: 'mgr/build/testPack',\r\n\t\t\t\t\t\t\t\t\t\tid: cs,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tlisteners: {\r\n\t\t\t\t\t\t\t\t\t\t'success': {\r\n\t\t\t\t\t\t\t\t\t\t\tfn: function(r) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tExt.MessageBox.show({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: config.title || '',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmsg: r.object.msg || '',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twidth: window.innerWidth / 100 * 50,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\theight: window.innerHeight / 100 * 50,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tbuttons: Ext.MessageBox.CANCEL,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: Ext.MessageBox.QUESTION\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\tself.refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t}, scope: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tgetResolver: function() {\r\n\t\t\t\t\t\t\t\tvar cs = this.getSelectedAsList()\r\n\t\t\t\t\t\t\t\tvar self = this\r\n\t\t\t\t\t\t\t\tvar data = this.getSelectionModel().getSelections()[0].data\r\n\t\t\t\t\t\t\t\tMODx.msg.confirm({\r\n\t\t\t\t\t\t\t\t\ttitle: _('create'),\r\n\t\t\t\t\t\t\t\t\ttext: _('confirm'),\r\n\t\t\t\t\t\t\t\t\turl: EasyPackConnector_url,\r\n\t\t\t\t\t\t\t\t\tparams: {\r\n\t\t\t\t\t\t\t\t\t\taction: 'mgr/build/genresolver',\r\n\t\t\t\t\t\t\t\t\t\tid: cs,\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tlisteners: {\r\n\t\t\t\t\t\t\t\t\t\t'success': {\r\n\t\t\t\t\t\t\t\t\t\t\tfn: function(r) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tExt.MessageBox.show({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: config.title || '',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmsg: r.message || '',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twidth: window.innerWidth / 100 * 50,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\theight: window.innerHeight / 100 * 50,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tbuttons: Ext.MessageBox.CANCEL,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: Ext.MessageBox.QUESTION\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\tself.refresh()\r\n\t\t\t\t\t\t\t\t\t\t\t}, scope: true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttitle: 'Wiki',\r\n\t\t\t\t\t\tid:'Wiki-tabs',\r\n\t\t\t\t\t\txtype: 'modx-tabs',\r\n\t\t\t\t\t\tdeferredRender: false,\r\n\t\t\t\t\t\tborder: true,\r\n\t\t\t\t\t\titems: [\r\n\r\n\t\t\t\t\t\t]\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t]\r\n\t}\r\n\r\n\tExt.apply(config, app)\r\n\tEasyPack.panel.Home.superclass.constructor.call(this, config) // Чёртова магия =)\r\n}\r\n\r\nExt.extend(EasyPack.panel.Home, MODx.Panel)\r\nExt.reg('EasyPack-panel-home', EasyPack.panel.Home)\r\n\r\nEasyPack.grid.ModGrid = function(config) { // Придумываем название, например, «Names»\r\n\tconfig = config || {}\r\n\tExt.apply(config, {\r\n\t\t// Сюда перемещаем все свойства нашей таблички\r\n\t\tpaging: true,\r\n\t\tautoHeight: true,\r\n\t\tviewConfig: {\r\n\t\t\tforceFit: true,\r\n\t\t\tscrollOffset: 0\r\n\t\t},\r\n\t\tremoteSort: true,\r\n\t\turl: EasyPackConnector_url,\r\n\t\tkeyField: 'id',\r\n\t\tgetSelectedAsList: function() {\r\n\t\t\tvar selects = this.getSelectionModel().getSelections()\r\n\t\t\tif(selects.length <= 0) return false\r\n\t\t\tvar cs = ''\r\n\t\t\tfor(var i = 0; i < selects.length; i++) {\r\n\t\t\t\tcs += ',' + selects[i].data[this.keyField]\r\n\t\t\t}\r\n\t\t\tcs = cs.substr(1)\r\n\t\t\treturn cs\r\n\t\t}\r\n\t})\r\n\tEasyPack.grid.ModGrid.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(EasyPack.grid.ModGrid, MODx.grid.Grid) // Наша табличка расширяет GridPanel\r\nExt.reg('EasyPack-grid', EasyPack.grid.ModGrid) // Регистрируем новый xtype\r\n\r\nEasyPack.window.modWindow = function(config) {\r\n\tconfig = config || {}\r\n\tExt.applyIf(config, {\r\n\t\ttitle: 'Create thing',\r\n\t\twidth: window.innerWidth / 100 * 50,\r\n\t\tsaveBtnText: 'Сохранить 💾',\r\n\t\turl: EasyPackConnector_url,\r\n\t})\r\n\tEasyPack.window.modWindow.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(EasyPack.window.modWindow, MODx.Window) // Расширяем MODX.Window\r\nExt.reg('EasyPack-window-modWindow', EasyPack.window.modWindow) // Регистрируем новый xtype\r\n//добавление EasyPack\r\n\r\n//окно редактора\r\nEasyPack.window.add = function(config) {\r\n\tconfig.updateData = Object.assign({\r\n\t\t'id': null,\r\n\t\t'name': null,\r\n\t\t'version': null,\r\n\t\t'date': null,\r\n\t\t'chunks': null,\r\n\t\t'snippets': null,\r\n\t\t'plugins': null,\r\n\t\t'templates': null,\r\n\t\t'resources': null,\r\n\t\t'menus': null,\r\n\t\t'core': null,\r\n\t\t'assets': null,\r\n\t\t'readme': null,\r\n\t\t'changelog': null,\r\n\t\t'setup_option': null,\r\n\t\t'license': null,\r\n\t\t'tables': null,\r\n\t\t'modUtilitiesRest': null,\r\n\t}, config.updateData)\r\n\tconfig.tables = function(key) {\r\n\t\tif(config.updateData.tables) {\r\n\t\t\tvar data = JSON.parse(config.updateData.tables)\r\n\t\t\tswitch( key ) {\r\n\t\t\t\tcase 'tables':\r\n\t\t\t\t\treturn data.tables.join(',')\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 'prefix':\r\n\t\t\t\t\treturn data.prefix\r\n\t\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\tthis.ident = config.ident || 'EasyPack' + Ext.id()\r\n\tvar fields = [\r\n\t\t{\r\n\t\t\txtype: 'hidden',\r\n\t\t\tname: 'id',\r\n\t\t\tid: 'add-' + this.ident + '-id',\r\n\t\t\tvalue: config.updateId || null,\r\n\t\t\tallowBlank: true\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'textfield',\r\n\t\t\tfieldLabel: _('name'),\r\n\t\t\tname: 'name',\r\n\t\t\tid: 'add-' + this.ident + '-name',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData.name || null,\r\n\t\t\tallowBlank: false,\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'textfield',\r\n\t\t\tfieldLabel: _('version'),\r\n\t\t\temptyText: '0.0.1-pl',\r\n\t\t\tname: 'version',\r\n\t\t\tid: 'add-' + this.ident + '-version',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData.version || null,\r\n\t\t\tallowBlank: false\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\txtype: 'EasyPack-combo-modComboSuper',\r\n\t\t\tfieldLabel: _('chunk'),\r\n\t\t\tname: 'chunks',\r\n\t\t\tid: 'add-' + this.ident + '-chunk',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: todata(config.updateData.chunks) || null,\r\n\t\t\tforceSelection: true,\r\n\t\t\tfields: ['id', 'name', 'category_name'],\r\n\t\t\turl: MODx.config.connector_url,\r\n\t\t\tbaseParams: {\r\n\t\t\t\taction: 'element/chunk/getlist', combo: 1, sort: 'id',\r\n\t\t\t\tdir: 'DESK',\r\n\t\t\t},\r\n\t\t\tallowBlank: true,\r\n\t\t\tvalueField: 'name',\r\n\t\t\tdisplayField: 'name',\r\n\t\t\ttpl: elemTemplate\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'EasyPack-combo-modComboSuper',\r\n\t\t\tfieldLabel: _('snippet'),\r\n\t\t\tname: 'snippets',\r\n\t\t\tid: 'add-' + this.ident + '-snippet',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: todata(config.updateData.snippets),\r\n\t\t\tforceSelection: true,\r\n\t\t\tfields: ['id', 'name', 'category_name'],\r\n\t\t\turl: MODx.config.connector_url,\r\n\t\t\tbaseParams: {\r\n\t\t\t\taction: 'element/snippet/getlist', combo: 1, sort: 'id',\r\n\t\t\t\tdir: 'DESK',\r\n\t\t\t},\r\n\t\t\tallowBlank: true,\r\n\t\t\tvalueField: 'name',\r\n\t\t\tdisplayField: 'name',\r\n\t\t\ttpl: elemTemplate\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'EasyPack-combo-modComboSuper',\r\n\t\t\tfieldLabel: _('plugin'),\r\n\t\t\tname: 'plugins',\r\n\t\t\tid: 'add-' + this.ident + '-plugin',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: todata(config.updateData.plugins),\r\n\t\t\tforceSelection: true,\r\n\t\t\tfields: ['id', 'name', 'category_name'],\r\n\t\t\turl: MODx.config.connector_url,\r\n\t\t\tbaseParams: {\r\n\t\t\t\taction: 'element/plugin/getlist', combo: 1, sort: 'id',\r\n\t\t\t\tdir: 'DESK'\r\n\t\t\t},\r\n\t\t\tallowBlank: true,\r\n\t\t\tvalueField: 'name',\r\n\t\t\tdisplayField: 'name',\r\n\t\t\ttpl: elemTemplate\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'EasyPack-combo-modComboSuper',\r\n\t\t\tfieldLabel: _('template'),\r\n\t\t\tname: 'templates',\r\n\t\t\tid: 'add-' + this.ident + '-template',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: todata(config.updateData.templates, 'templatename'),\r\n\t\t\tforceSelection: true,\r\n\t\t\tfields: ['id', 'templatename', 'category_name'],\r\n\t\t\turl: MODx.config.connector_url,\r\n\t\t\tbaseParams: {\r\n\t\t\t\taction: 'element/template/getlist', combo: 1, sort: 'id',\r\n\t\t\t\tdir: 'DESK',\r\n\t\t\t},\r\n\t\t\tallowBlank: true,\r\n\t\t\tvalueField: 'templatename',\r\n\t\t\tdisplayField: 'templatename',\r\n\t\t\ttpl: elemTemplate2\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'EasyPack-combo-modComboSuper',\r\n\t\t\tfieldLabel: _('resources'),\r\n\t\t\tname: 'resources',\r\n\t\t\tid: 'add-' + this.ident + '-resources',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: todata(config.updateData.resources, 'id'),\r\n\t\t\tforceSelection: true,\r\n\t\t\tfields: ['id', 'pagetitle', 'uri'],\r\n\t\t\turl: MODx.config.connector_url,\r\n\t\t\tbaseParams: {\r\n\t\t\t\taction: 'resource/getlist', combo: 1, sort: 'id',\r\n\t\t\t\tdir: 'DESK',\r\n\t\t\t},\r\n\t\t\tallowBlank: true,\r\n\t\t\tvalueField: 'id',\r\n\t\t\tdisplayField: 'id',\r\n\t\t\ttpl: elemTemplate6\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'EasyPack-combo-modComboSuper',\r\n\t\t\tfieldLabel: _('edit_menu'),\r\n\t\t\tname: 'menus',\r\n\t\t\tid: 'add-' + this.ident + '-menu',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: todata(config.updateData.menus, 'text'),\r\n\t\t\tforceSelection: true,\r\n\t\t\tfields: ['text', 'text_lex', 'parent', 'namespace'],\r\n\t\t\turl: MODx.config.connector_url,\r\n\t\t\tbaseParams: {\r\n\t\t\t\taction: 'system/menu/getlist', combo: 1, sort: 'namespace',\r\n\t\t\t\tdir: 'DESK',\r\n\t\t\t},\r\n\t\t\tallowBlank: true,\r\n\t\t\tvalueField: 'text',\r\n\t\t\tdisplayField: 'text',\r\n\t\t\ttpl: elemTemplate3\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'EasyPack-combo-modComboSuper',\r\n\t\t\tfieldLabel: _('settings'),\r\n\t\t\tname: 'settings',\r\n\t\t\tid: 'add-' + this.ident + '-setting',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: todata(config.updateData.settings, 'key'),\r\n\t\t\tforceSelection: true,\r\n\t\t\tfields: ['key', 'name_trans', 'namespace'],\r\n\t\t\turl: MODx.config.connector_url,\r\n\t\t\tbaseParams: {\r\n\t\t\t\taction: 'system/settings/getlist', combo: 1, sort: 'namespace',\r\n\t\t\t\tdir: 'DESK',\r\n\t\t\t},\r\n\t\t\tallowBlank: true,\r\n\t\t\tvalueField: 'key',\r\n\t\t\tdisplayField: 'key',\r\n\t\t\ttpl: elemTemplate4\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\txtype: 'textarea',\r\n\t\t\ttoolTip: 'имена таблиц через запятую (с префиксом)',\r\n\t\t\tfieldLabel: _('EasyPack.tables'),\r\n\t\t\tname: 'tables',\r\n\t\t\tid: 'add-' + this.ident + '-tables',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.tables('tables') || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t\tlisteners: ToolTip,\r\n\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'textfield',\r\n\t\t\tfieldLabel: _('EasyPack.prefix'),\r\n\t\t\tname: 'prefix',\r\n\t\t\tid: 'add-' + this.ident + '-prefix',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.tables('prefix') || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t\tlisteners: ToolTip,\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'textfield',\r\n\t\t\tfieldLabel: _('EasyPack.core'),\r\n\t\t\ttoolTip: _('EasyPack.description.core'),\r\n\t\t\tlisteners: ToolTip,\r\n\t\t\tname: 'core',\r\n\t\t\tid: 'add-' + this.ident + '-core',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData['core'] || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t\tsource: MODx.config.default_media_source,\r\n\t\t\topenTo: '/core/components',\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'textfield',\r\n\t\t\tfieldLabel: _('EasyPack.assets'),\r\n\t\t\ttoolTip: _('EasyPack.description.assets'),\r\n\t\t\tlisteners: ToolTip,\r\n\t\t\tname: 'assets',\r\n\t\t\tid: 'add-' + this.ident + '-assets',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData['assets'] || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t\tsource: MODx.config.default_media_source,\r\n\t\t\topenTo: '/core/components',\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'textarea',\r\n\t\t\tname: 'requires',\r\n\t\t\tfieldLabel: _('EasyPack.requires'),\r\n\t\t\ttooltip: _('EasyPack.description.requires'),\r\n\t\t\tid: 'add-' + this.ident + '-requires',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData['requires'] || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t},\r\n\r\n\t\t{\r\n\t\t\txtype: 'modx-combo-browser',\r\n\t\t\tname: 'readme',\r\n\t\t\ttooltip: _('EasyPack.description.readme'),\r\n\t\t\tfieldLabel: _('EasyPack.readme'),\r\n\t\t\tid: 'add-' + this.ident + '-readme',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData['readme'] || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t\tsource: MODx.config.default_media_source,\r\n\t\t\topenTo: '/core/components'\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'modx-combo-browser',\r\n\t\t\tname: 'changelog',\r\n\t\t\ttooltip: _('EasyPack.description.changelog'),\r\n\t\t\tfieldLabel: _('EasyPack.changelog'),\r\n\t\t\tid: 'add-' + this.ident + '-changelog',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData['changelog'] || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t\tsource: MODx.config.default_media_source,\r\n\t\t\topenTo: '/core/components'\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'modx-combo-browser',\r\n\t\t\tfieldLabel: _('EasyPack.setup_option'),\r\n\t\t\ttooltip: _('EasyPack.description.setup_option'),\r\n\t\t\tlisteners: ToolTip,\r\n\t\t\tname: 'setup_option',\r\n\t\t\tid: 'add-' + this.ident + '-setup_option',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData['setup_option'] || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t\tallowedFileTypes: 'php',\r\n\t\t\tsource: MODx.config.default_media_source,\r\n\t\t\topenTo: '/core/components'\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'modx-combo-browser',\r\n\t\t\ttooltip: _('EasyPack.description.php_resolver'),\r\n\t\t\tfieldLabel: _('EasyPack.php_resolver'),\r\n\t\t\tlisteners: ToolTip,\r\n\t\t\tname: 'php_resolver',\r\n\t\t\tid: 'add-' + this.ident + '-php_resolver',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData['php_resolver'] || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t\tallowedFileTypes: 'php',\r\n\t\t\tsource: MODx.config.default_media_source,\r\n\t\t\topenTo: 'core/components/'\r\n\r\n\t\t},\r\n\t\t{\r\n\t\t\txtype: 'modx-combo-browser',\r\n\t\t\ttooltip: _('EasyPack.description.license'),\r\n\t\t\tfieldLabel: _('EasyPack.license'),\r\n\t\t\tlisteners: ToolTip,\r\n\t\t\tname: 'license',\r\n\t\t\tid: 'add-' + this.ident + '-license',\r\n\t\t\tanchor: '99%',\r\n\t\t\tvalue: config.updateData['license'] || null,\r\n\t\t\tallowBlank: true,\r\n\t\t\trootVisible: true,\r\n\t\t\tsource: MODx.config.default_media_source,\r\n\t\t\topenTo: '/core/components'\r\n\t\t},\r\n\t]\r\n\tif(modUtil) {\r\n\t\tfields.push(\r\n\t\t\t{\r\n\t\t\t\txtype: 'EasyPack-combo-modComboSuper',\r\n\t\t\t\tfieldLabel: _('EasyPack.modUtilitiesRest'),\r\n\t\t\t\tname: 'modUtilitiesRest',\r\n\t\t\t\tid: 'add-' + this.ident + '-modUtilitiesRest',\r\n\t\t\t\tanchor: '99%',\r\n\t\t\t\tvalue: todata(config.updateData.modUtilitiesRest, 'url'),\r\n\t\t\t\tforceSelection: true,\r\n\t\t\t\tfields: ['id', 'url', 'snippet'],\r\n\t\t\t\turl: modUtilConnector_url,\r\n\t\t\t\tbaseParams: {\r\n\t\t\t\t\taction: 'mgr/rest/getRest', combo: 1, sort: 'id',\r\n\t\t\t\t\tdir: 'DESK',\r\n\t\t\t\t},\r\n\t\t\t\tallowBlank: true,\r\n\t\t\t\tvalueField: 'url',\r\n\t\t\t\tdisplayField: 'url',\r\n\t\t\t\ttpl: elemTemplate5\r\n\t\t\t},\r\n\t\t)\r\n\t}\r\n\r\n\tExt.applyIf(config, {\r\n\t\ttitle: _('EasyPack.create_new_pack'),\r\n\t\tfields: fields,\r\n\t\taction: 'mgr/create',\r\n\t\tlisteners: {\r\n\t\t\tbeforeSubmit: function(a) {\r\n\t\t\t\t// if(typeof a.allowMethod !== 'string' && a.allowMethod) {\r\n\t\t\t\t// \tvar allowMethod = a.allowMethod.join()\r\n\t\t\t\t// \tif(typeof allowMethod == 'string') {\r\n\t\t\t\t// \t\t$(`input[name=\"allowMethod\"]`).each(function() {\r\n\t\t\t\t// \t\t\t$(this).val(allowMethod)\r\n\t\t\t\t// \t\t\t$(this).attr('value', allowMethod)\r\n\t\t\t\t// \t\t\tthis.value = allowMethod\r\n\t\t\t\t// \t\t})\r\n\t\t\t\t// \t}\r\n\t\t\t\t// }\r\n\t\t\t\treturn true\r\n\t\t\t},\r\n\t\t\tsuccess: function() {\r\n\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\ttitle: _('created'),\r\n\t\t\t\t\tmessage: 'Готово',\r\n\t\t\t\t\tdelay: 3\r\n\t\t\t\t})\r\n\t\t\t\tExt.getCmp('EasyPack-main-table').refresh()\r\n\t\t\t\tthis.remove()\r\n\t\t\t},\r\n\t\t\tfailure: function() {\r\n\t\t\t\tthis.remove()\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\tEasyPack.window.add.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(EasyPack.window.add, EasyPack.window.modWindow) // Расширяем MODX.Window\r\nExt.reg('EasyPack-window-add', EasyPack.window.add) // Регистрируем новый xtype\r\n//добавление категории\r\n\r\n//окно редактора2\r\nEasyPack.window.create = function(config) {\r\n\tconfig.updateData = Object.assign({\r\n\t\t'name': null,\r\n\t}, config.updateData)\r\n\tsaveBtnText: _('EasyPack.create'),\r\n\t\tthis.ident = config.ident || 'EasyPack' + Ext.id()\r\n\tconfig.updateData.name_lower = config.updateData.name.toLowerCase()\r\n\tvar self = this\r\n\tExt.applyIf(config, {\r\n\t\tid: 'EasyPack-window-' + this.ident + '-create',\r\n\t\ttitle: _('EasyPack.create_structure') + ' - ' + config.updateData.name,\r\n\t\tfields: [\r\n\t\t\t{\r\n\t\t\t\txtype: 'hidden',\r\n\t\t\t\tname: 'id',\r\n\t\t\t\tvalue: config.updateId || null,\r\n\t\t\t\tallowBlank: true\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__js_mgr_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__js_mgr_',\r\n\t\t\t\tboxLabel: _('_js_mgr_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t}, {\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__controllers_mgr_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__controllers_mgr_',\r\n\t\t\t\tboxLabel: _('_controllers_mgr_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t}, {\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__docs_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__docs_',\r\n\t\t\t\tboxLabel: _('_docs_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t}, {\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__elements_chunks_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__elements_chunks_',\r\n\t\t\t\tboxLabel: _('_elements_chunks_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t}, {\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__elements_plugins_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__elements_plugins_',\r\n\t\t\t\tboxLabel: _('_elements_plugins_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t}, {\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__elements_snippets_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__elements_snippets_',\r\n\t\t\t\tboxLabel: _('_elements_snippets_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t}, {\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__elements_templates_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__elements_templates_',\r\n\t\t\t\tboxLabel: _('_elements_templates_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t}, {\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__lexicon_en_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__lexicon_en_',\r\n\t\t\t\tboxLabel: _('_lexicon_en_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t}, {\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__processors_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__processors_',\r\n\t\t\t\tboxLabel: _('_processors_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__model_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__model_',\r\n\t\t\t\tboxLabel: _('_model_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__namespace_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__namespace_',\r\n\t\t\t\tboxLabel: _('_namespace_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\txtype: 'xcheckbox',\r\n\t\t\t\tname: 'create__elements_',\r\n\t\t\t\tid: 'add-' + this.ident + '-create__elements_',\r\n\t\t\t\tboxLabel: _('_elements_', {name: config.updateData.name_lower}),\r\n\t\t\t\toriginalValue: true,\r\n\t\t\t},\r\n\t\t],\r\n\t\tsaveBtnText: _('EasyPack.create') + ' 🗂',\r\n\t\taction: 'mgr/build/create',\r\n\t\tbbar: [\r\n\t\t\t{\r\n\t\t\t\ttext: _('EasyPack.Select_All'),\r\n\t\t\t\thandler: function(e) {\r\n\t\t\t\t\tvar f = Ext.getCmp('EasyPack-window-' + self.ident + '-create').fields\r\n\t\t\t\t\tfor(x of f) {\r\n\t\t\t\t\t\tif(x.id) {\r\n\t\t\t\t\t\t\tExt.getCmp(x.id).setValue(true)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\ttext: _('EasyPack.Deselect_All'),\r\n\t\t\t\thandler: function(e) {\r\n\t\t\t\t\tvar f = Ext.getCmp('EasyPack-window-' + self.ident + '-create').fields\r\n\t\t\t\t\tfor(x of f) {\r\n\t\t\t\t\t\tif(x.id) {\r\n\t\t\t\t\t\t\tExt.getCmp(x.id).setValue(false)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t],\r\n\t\tlisteners: {\r\n\t\t\tsuccess: function() {\r\n\t\t\t\tMODx.msg.status({\r\n\t\t\t\t\ttitle: _('created'),\r\n\t\t\t\t\tmessage: 'Готово',\r\n\t\t\t\t\tdelay: 3\r\n\t\t\t\t})\r\n\t\t\t\tExt.getCmp('EasyPack-main-table').refresh()\r\n\t\t\t\tthis.remove()\r\n\t\t\t},\r\n\t\t\tfailure: function() {\r\n\t\t\t\tthis.remove()\r\n\t\t\t}\r\n\t\t},\r\n\t})\r\n\tEasyPack.window.create.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(EasyPack.window.create, EasyPack.window.modWindow) // Расширяем MODX.Window\r\nExt.reg('EasyPack-window-create', EasyPack.window.create) // Регистрируем новый xtype\r\n//добавление категории\r\n\r\nEasyPack.combo.modCombo = function(config) {\r\n\tconfig = config || {}\r\n\tthis.ident = config.ident || 'mecnewsletter' + Ext.id()\r\n\tExt.applyIf(config, {\r\n\t\turl: EasyPackConnector_url,\r\n\t\tvalueField: 'id',\r\n\t\twidth: '100%',\r\n\t\tanchor: '99%',\r\n\t\teditable: true,\r\n\t\tpageSize: 20,\r\n\t\tpreventRender: true,\r\n\t\tforceSelection: true,\r\n\t\tenableKeyEvents: true,\r\n\t})\r\n\tEasyPack.combo.modCombo.superclass.constructor.call(this, config) // Магия\r\n}\r\nExt.extend(EasyPack.combo.modCombo, MODx.combo.ComboBox) // Расширяем MODX.ComboBox\r\nExt.reg('EasyPack-combo-modCombo', EasyPack.combo.modCombo) // Регистрируем новый xtype\r\n\r\nEasyPack.combo.modComboSuper = function(config) {\r\n\tconfig = config || {}\r\n\tExt.applyIf(config, {\r\n\t\txtype: 'superboxselect'\r\n\t\t, allowBlank: true\r\n\t\t, msgTarget: 'under'\r\n\t\t, allowAddNewData: true\r\n\t\t, addNewDataOnBlur: true\r\n\t\t, width: '100%'\r\n\t\t, editable: true\r\n\t\t, pageSize: 20\r\n\t\t, preventRender: true\r\n\t\t, forceSelection: true\r\n\t\t, enableKeyEvents: true\r\n\t\t, minChars: 2\r\n\t\t, hiddenName: config.name + '[]'\r\n\t\t, store: new Ext.data.JsonStore({\r\n\t\t\tid: (config.name || 'tags') + '-store'\r\n\t\t\t, root: 'results'\r\n\t\t\t, autoLoad: true\r\n\t\t\t, autoSave: false\r\n\t\t\t, totalProperty: 'total'\r\n\t\t\t, fields: config.fields\r\n\t\t\t, url: config.url || EasyPackConnector_url\r\n\t\t\t, baseParams: config.baseParams\r\n\t\t})\r\n\t\t, mode: 'remote'\r\n\t\t, displayField: 'value'\r\n\t\t, valueField: 'value'\r\n\t\t, triggerAction: 'all'\r\n\t\t, extraItemCls: 'x-tag'\r\n\t\t, expandBtnCls: 'x-form-trigger'\r\n\t\t, clearBtnCls: 'x-form-trigger'\r\n\t\t, listeners: {\r\n\t\t\tnewitem: function(config, v, f) {bs.addItem({tag: v})}\r\n\t\t}\r\n\t\t, renderTo: Ext.getBody()\r\n\t})\r\n\tEasyPack.combo.modComboSuper.superclass.constructor.call(this, config)\r\n}\r\nExt.extend(EasyPack.combo.modComboSuper, Ext.ux.form.SuperBoxSelect)\r\nExt.reg('EasyPack-combo-modComboSuper', EasyPack.combo.modComboSuper)\r\n\r\n"],"file":"main.tab.js"}